<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜„ìˆ™ì´ ê±´ê°• ê´€ë¦¬ì•±</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- AUTH CHECK - Must be first! -->
    <script>
        // Check authentication before loading the app
        (function() {
            const authToken = localStorage.getItem('authToken');
            const currentPath = window.location.pathname;
            
            // Allow access to login page without auth
            if (currentPath.includes('login.html')) {
                return;
            }
            
            // If no token, redirect to login
            if (!authToken) {
                window.location.href = '/login.html';
                return;
            }
        })();
    </script>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 8px;">
                <h1 style="font-size: 20px; margin: 0; flex: 1; min-width: 120px;">í˜„ìˆ™ì´ ê±´ê°• ê´€ë¦¬ì•±</h1>
                <div style="display: flex; align-items: center; gap: 6px; flex-shrink: 0;">
                    <span id="username-display" style="font-size: 11px; color: #666; white-space: nowrap; max-width: 150px; overflow: hidden; text-overflow: ellipsis;"></span>
                    <button onclick="handleLogout()" style="padding: 4px 10px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; white-space: nowrap;">
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>
            <div class="week-nav">
                <button id="prevWeek" class="btn-nav">â† ì§€ë‚œ ì£¼</button>
                <span id="weekDisplay" class="week-display">2025-10-06 ~ 2025-10-12</span>
                <button id="nextWeek" class="btn-nav">ë‹¤ìŒ ì£¼ â†’</button>
            </div>
            <button id="copyFromLastWeek" class="btn-secondary" style="margin-top: 10px;">ğŸ“‹ ì§€ë‚œ ì£¼ ìš´ë™ ë³µì‚¬</button>
            <a href="report.html" class="report-link">ğŸ“Š ì§€ë‚œ ì£¼ ë¦¬í¬íŠ¸</a>
        </header>

        <!-- Tab Navigation -->
        <nav class="tabs">
            <button class="tab-btn active" data-tab="exercise">ğŸ’ª ìš´ë™</button>
            <button class="tab-btn" data-tab="health">ğŸ“ˆ ê±´ê°•ì§€í‘œ</button>
            <button class="tab-btn" data-tab="meal">ğŸ½ï¸ ì‹ë‹¨</button>
        </nav>

        <!-- Exercise Tab -->
        <div id="exerciseTab" class="tab-content active">
            <div class="master-exercise-section">
                <h2>ìš´ë™ ëª©ë¡ ê´€ë¦¬</h2>
                <div class="add-exercise-form">
                    <input type="text" id="exerciseName" placeholder="ìš´ë™ ì´ë¦„ (ì˜ˆ: ëŸ°ë‹)" class="input-field">
                    <select id="exerciseDuration" class="select-field">
                        <option value="10">10ë¶„</option>
                        <option value="20">20ë¶„</option>
                        <option value="30" selected>30ë¶„</option>
                        <option value="40">40ë¶„</option>
                        <option value="50">50ë¶„</option>
                        <option value="60">60ë¶„</option>
                        <option value="70">70ë¶„</option>
                        <option value="80">80ë¶„</option>
                        <option value="90">90ë¶„</option>
                        <option value="100">100ë¶„</option>
                        <option value="110">110ë¶„</option>
                        <option value="120">120ë¶„</option>
                        <option value="130">130ë¶„</option>
                        <option value="140">140ë¶„</option>
                        <option value="150">150ë¶„</option>
                        <option value="160">160ë¶„</option>
                        <option value="170">170ë¶„</option>
                        <option value="180">180ë¶„</option>
                    </select>
                    <button id="addExerciseBtn" class="btn-primary">ì¶”ê°€</button>
                </div>
                <div id="masterExerciseList" class="master-exercise-list"></div>
            </div>

            
            <!-- Day Quick Navigation -->
            <div class="day-quick-nav">
                <div class="day-quick-nav-title">ë¹ ë¥¸ ì´ë™</div>
                <div class="day-nav-buttons">
                    <button class="day-nav-btn" data-day="0">ì›”</button>
                    <button class="day-nav-btn" data-day="1">í™”</button>
                    <button class="day-nav-btn" data-day="2">ìˆ˜</button>
                    <button class="day-nav-btn" data-day="3">ëª©</button>
                    <button class="day-nav-btn" data-day="4">ê¸ˆ</button>
                    <button class="day-nav-btn" data-day="5">í† </button>
                    <button class="day-nav-btn" data-day="6">ì¼</button>
                </div>
            </div>

            <div class="weekly-exercise-section">
                <h2>ì£¼ê°„ ìš´ë™ ê³„íš</h2>
                <div id="dayCards" class="day-cards"></div>
            </div>
        </div>

        <!-- Health Tab -->
        <div id="healthTab" class="tab-content">
            <h2>ê±´ê°•ì§€í‘œ</h2>
            <div class="health-metrics-section">
                <div class="metric-item">
                    <label for="weightInput">ëª¸ë¬´ê²Œ (kg)</label>
                    <input type="number" id="weightInput" step="0.1" placeholder="65.5" class="input-field">
                </div>
                
                <div class="custom-metrics">
                    <h3>ì»¤ìŠ¤í…€ ì§€í‘œ</h3>
                    <div class="add-metric-form">
                        <input type="text" id="metricName" placeholder="ì§€í‘œ ì´ë¦„ (ì˜ˆ: ì²´ì§€ë°©ë¥ )" class="input-field">
                        <button id="addMetricBtn" class="btn-primary">ì§€í‘œ ì¶”ê°€</button>
                    </div>
                    <div id="customMetricsList" class="custom-metrics-list"></div>
                </div>
            </div>
        </div>

        <!-- Meal Tab -->
        <div id="mealTab" class="tab-content">
            <h2>ì‹ë‹¨ ê¸°ë¡</h2>
            <div class="meal-section">
                <div class="add-meal-form">
                    <!-- NO min/max restrictions - allows past and future dates -->
                    <input type="date" id="mealDate" class="input-field">
                    <select id="mealType" class="select-field">
                        <option value="ì•„ì¹¨">ì•„ì¹¨</option>
                        <option value="ì ì‹¬">ì ì‹¬</option>
                        <option value="ì €ë…">ì €ë…</option>
                        <option value="ê°„ì‹">ê°„ì‹</option>
                    </select>
                    <input type="text" id="mealFood" placeholder="ìŒì‹ (ì˜ˆ: ë°¥, ê¹€ì¹˜ì°Œê°œ, ê³„ë€)" class="input-field">
                    <input type="file" id="mealPhoto" accept="image/*" class="file-input">
                    <input type="number" id="mealCalories" placeholder="ì¹¼ë¡œë¦¬ (ìë™ ì¶”ì •)" class="input-field">
                    <button id="addMealBtn" class="btn-primary">ì‹ë‹¨ ì¶”ê°€</button>
                </div>
                <div id="mealList" class="meal-list"></div>
            </div>
        </div>
    </div>

    <script>
        // Display username
        const username = localStorage.getItem('username');
        if (username) {
            document.getElementById('username-display').textContent = `${username}ë‹˜`;
        }

        // Logout function
        function handleLogout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('username');
                window.location.href = '/login.html';
            }
        }
    </script>
    <script src="app_new.js"></script>
</body>
</html>
